---
title: "Automated radiotherapy planning"
excerpt: "Radiotherapy planning is complex and time consuming. We've made dozens of inventions, primarily based on machine learning and optimization, that can guide or automate parts of the radiotherapy workflow.<br><br><img src='/images/sectors.jpg'>"
collection: portfolio
---

Thanks to the development of more effective cancer treatments, people diagnosed with cancer today live longer and enjoy a better quality of life than ever before. One of the main treatment forms is radiotherapy, in which ionizing radiation is directed towards a tumor with the aim of killing the cancerous cells while sparing healthy tissue. Radiotherapy is cost-effective compared to the alternatives, yet the increasing demand together with the overall need to reduce healthcare spending create a strong pressure to further streamline the treatments. 

## Contributions

In inverse planning, treatment plans are generated by solving an optimization problem that balances various conflicting objectives, such as high dose to target, normal tissue sparing and treatment complexity. Commonly, the different criteria are combined using a weighted sum, where each weight determines the relative importance of that criterion. 

Finding acceptable weights is often a manual and tedious process of trial-and-error, especially so because evaluating a single choice of parameters requires solving the full optimization problem, which may take from a few seconds up to an hour depending on the application. Because of the interactivity of this procedure, it is highly desirable to reduce the solution times as much as possible. 

Me and colleagues at Elekta did the research groundwork for the [next-generation treatment optimizer](https://www.elekta.com/products/stereotactic-radiosurgery/leksell-gamma-knife-lightning/) for Gamma Knife radiosurgery. This included new convex surrogates for common clinical objectives \[[P4](#patents), [P9](#patents)\] as well as techniques for reducing the problem size \[[P2](#patents)\] and making it more amenable to off-the-shelf optimization solvers [\[J3\]](#journal-papers).

We also invented AI-powered techniques for compressing the optimization problem \[[P11](#patents)\] and for automatically assigning weights based on historical treatment data \[[P7](#patents)\]. Others have proposed methods that directly predict the optimized dose distribution, but these normally fail to take the limitations of the treatment delivery into account . We, on the other hand, developed a method that incorporates the constraints directly into a neural network \[[P10](#patents)\], which means that the predicted treatment plan is actually realizable. 

Furthermore, we developed a quality assurance tool for gauging whether the generated plan meets the expectations based on past treatements \[[J2](#journal-papers), [P1](#patents)\]

Another computational bottlenecks in inverse planning is dose calculation, i.e. simulation of how the ionizing radiation interacts and deposits dose. To accelerate this, we explored a deep learning-based method that could accurately "fast-forward" the results of a short (and very noisy) dose calculation into an accurate one \[[P6](#patents)\].

Most dose calculation methods require a CT image as input, but in clinical reality it is not always available. Targeting such scenarios, we've both developed methods that are robust to missing modalities \[[P3](#patents)\] and explicitly synthesize the missing data \[[J1](#journal-papers)\].

Finally, a long-term vision is that future treatment planning software will consist of hybrid learned/programmed modules chained together and trained in an end-to-end fashion. In pursuit of this vision we've explored how the dose calculation step can be implemented via so called differentiable programming \[[P8](#patents)\].




## References

#### Journal papers
###### \[J1\]  [<SPAN STYLE="font-weight:normal">**Sjölund, J.**, Forsberg, D., Andersson, M., & Knutsson, H. (2015). Generating patient specific pseudo-CT of the head from MR using atlas-based regression. Physics in Medicine & Biology, 60(2), 825.</SPAN>](https://doi.org/10.1088/0031-9155/60/2/825)

###### \[J2\] [<SPAN STYLE="font-weight:normal">Munter, J. S., and **Sjölund, J.** (2015). Dose-volume histogram prediction using density estimation. Physics in Medicine & Biology, 60(17), 6923.</SPAN>](https://doi.org/10.1088/0031-9155/60/17/6923)

###### \[J3\] [<SPAN STYLE="font-weight:normal">**Sjölund, J.**, Riad, S., Hennix, M., & Nordström, H. (2019). A linear programming approach to inverse planning in Gamma Knife radiosurgery. Medical physics, 46(4), 1533-1544.</SPAN>](https://doi.org/10.1002/mp.13440)


#### Patents
###### \[P1\] [<SPAN STYLE="font-weight:normal">**Sjölund, J.** and Han X., System and method for automatic treatment planning. US Patent 10,046,177. Granted Aug. 14, 2018.</SPAN>](https://patents.google.com/patent/US10046177B2/en)

###### \[P2\] [<SPAN STYLE="font-weight:normal">**Sjölund, J.** and Nordström, H., Convex inverse planning method. US patent 10,744,343. Granted Aug. 18, 2020.</SPAN>](https://patents.google.com/patent/US10744343B2/en)

###### \[P3\] [<SPAN STYLE="font-weight:normal">**Sjölund, J.** and Adler, J., Modality-agnostic method for medical image representation. US patent 10,762,398. Granted Sep. 1, 2020.</SPAN>](https://patents.google.com/patent/US10762398B2/en)

###### \[P4\] [<SPAN STYLE="font-weight:normal">Nordström, H., Somell, B., Riad, S., and **Sjölund, J.**, Methods for inverse planning. US patent 10,888,711. Granted Jan. 12, 2021.</SPAN>](https://patents.google.com/patent/US10888711B2/en)

###### \[P5\] [<SPAN STYLE="font-weight:normal">**Sjölund, J.**, Radiotherapy planning systems. US patent 10,946,215. Granted Mar. 16, 2021.</SPAN>](https://patents.google.com/patent/US10946215B2/en)

###### \[P6\] [<SPAN STYLE="font-weight:normal">Eriksson, M., **Sjölund, J.**, Öström, L., Tilly, D., Kimstrand, P., and Adler, J., Computing radiotherapy dose distribution. US patent 11,020,615. Granted Jun. 1, 2021.</SPAN>](https://patents.google.com/patent/US11020615B2/en)

###### \[P7\] [<SPAN STYLE="font-weight:normal">**Sjölund, J.**, Systems and methods for optimizing treatment planning. US Patent 11,056,243. Granted Jul. 6, 2021.</SPAN>](https://patents.google.com/patent/US11056243B2/en)

###### \[P8\] [<SPAN STYLE="font-weight:normal">**Sjölund, J.**, Radiotherapy treatment plans using differentiable dose functions. US patent 11,097,128. Granted Aug. 24, 2021.</SPAN>](https://patents.google.com/patent/US11097128B2/en)

###### \[P9\] [<SPAN STYLE="font-weight:normal">Nordström, H., Riad, S., and **Sjölund, J.**, Methods for inverse planning. US patent 11,351,396. Granted Jun. 7, 2022.</SPAN>](https://patents.google.com/patent/US11351396B2/en)

###### \[P10\] [<SPAN STYLE="font-weight:normal">**Sjölund, J.** and Adler, J., Generation of realizable radiotherapy plans. US patent 11,358,003. Granted Jun. 14, 2022.</SPAN>](https://patents.google.com/patent/US11358003B2/en)

###### \[P11\] [<SPAN STYLE="font-weight:normal">**Sjölund, J.**, Compressing radiotherapy treatment plan optimization problems. US patent 11,367,520. Granted Jun. 21, 2022.</SPAN>](https://patents.google.com/patent/US11367520B2/en)







